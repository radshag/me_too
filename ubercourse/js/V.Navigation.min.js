/**
 * V.Navigation.js
 * Ubercourse v0.15.0
 * 
 * VinciWorks
 * https://vinciworks.com/
 * Copyright (c) 2017-2018 VinciWorks, All Rights Reserved.
 * 
 * Updated: Tue, 06 Mar 2018 14:03:46 GMT
 * 
 */var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};;(function initNavigation(V){V.Navigation={go:go,next:next,prev:prev,lock:lock,unlock:unlock,isLocked:function isLocked(){return _isLocked;},showGate:showGate,hideGate:hideGate,openGate:openGate,blink:blink,stopBlink:stopBlink,closePeripherals:closePeripherals,setOrder:setOrder};V.Audio={play:playAudio,stop:stopAudio,pause:pauseAudio,mute:muteAudio,unmute:unmuteAudio,disable:disableAudio,enable:enableAudio};var body=document.body;var gateText=document.querySelector('.gate__text');var currentPageElement=void 0;var currentPageId=void 0;var currentParentId=void 0;var currentParentElement=void 0;var currentTimelineId=void 0;var tl=void 0;var targetPageElement=void 0;var targetPageId=void 0;var targetParentElement=void 0;var targetParentId=void 0;var isTimelinesActive=V.Timelines&&V.Timelines.isActive;var _isLocked=false;function lock(){_isLocked=true;}function unlock(){_isLocked=false;}var audioEnabled=enableAudio();var audioNowPlaying=void 0;var audioTimeout=void 0;var audioId=void 0;var audioFiles={};var isMuted=!!V.SCORM.get('mute');var pageNavigationOrder=Array.from(document.getElementsByClassName('page'),function(page){return page.id;});function setOrder(pageList){pageNavigationOrder=pageList;}if(audioEnabled){CustomEase.create('audioEaseOut','M0,0 C0,0.9 0.1,1 1,1');initMuteButton();}else{document.body.classList.add('-audio-disabled');}initNavigateOnKeydown();function go(id,options){options=options||{};if((typeof id==='undefined'?'undefined':_typeof(id))==='object'){options=id;}if(typeof id==='string'){targetPageId=id;}else if(id instanceof Element&&id.classList.contains('page')){targetPageId=id.id;}else if(options.id){targetPageId=options.id;}if(!targetPageId){console.warn('V.Navigation.go() called with no target page.');}var trDur=options.transitionDuration||0.3;var targetParentId=V.Pages[targetPageId]&&V.Pages[targetPageId].parent;if(V.Pages[targetPageId]&&V.Pages[targetPageId].children){targetParentId=targetPageId;targetPageId=V.Pages[targetPageId].children[0];}if(!isNewPageValid()){return false;}if(currentPageId&&V.Pages[currentPageId].onLeave&&V.Pages[currentPageId].onLeave(targetPageId)===false){return false;}targetPageElement=V.Pages[targetPageId].element;targetParentId=V.Pages[targetPageId].parent;targetParentElement=targetParentId?V.Pages[targetParentId].element:null;if(currentPageId){currentPageElement=V.Pages[currentPageId].element;currentParentId=V.Pages[currentPageId].parent;currentParentElement=currentParentId?V.Pages[currentParentId].element:null;}closePeripherals();if(audioEnabled){playAudio(V.Pages[targetPageId].audio);}transition();callOnEnter();updateSCORM();updatePeripherals();currentPageId=targetPageId;currentPageElement=targetPageElement;currentParentId=targetParentId;currentParentElement=targetParentElement;if(V.Pages[currentPageId].hasInnerPages&&!innerPageIds){navigateToInnerPage(0);}return true;function isNewPageValid(){if(!targetParentId&&currentPageId&&targetPageId===V.Pages[currentPageId].parent){console.log('"',targetPageId,'"is the parent of the current page, "',currentPageId,'"');return false;}if(!V.Pages[targetPageId]){console.error('The page',targetPageId,'is not registered in the `V.Pages` object.');return false;}if(!V.Pages[targetPageId].element){console.error('Error: Can\'t navigate to',targetPageId,'because that page doesnâ€™t exist.');return false;}if(targetPageId===currentPageId){console.log('Can\'t navigate to',targetPageId,'because that page is already open!');return false;}return true;}function transition(){if(targetParentId){openChildPage();}else{openNewPage();}}function openNewPage(){var transition=options.transition||'fade';if(!currentPageElement){if(transition!=='fade'){targetPageElement.style.display='block';targetPageElement.style.opacity=1;}else{fadeIn(targetPageElement);}}else{scrollToTop();if(currentTimelineId){endCurrentTimeline();}if(transition=='fade'){fadeIn(targetPageElement);if(currentParentId){fadeOut(currentParentElement);fadeOutChild(currentPageElement);}else{fadeOut(currentPageElement);}}else{targetPageElement.style.zIndex=2;targetPageElement.style.display='block';currentPageElement.style.zIndex=1;currentPageElement.style.display='none';}}}function openChildPage(){if(tl)console.log('label: ',tl.currentLabel());var transition=options.transition||'fade';if(!currentPageElement){if(isTargetInTimeline()){startNewTimeline();targetParentElement.style.display='block';targetParentElement.style.opacity=1;}else{targetParentElement.style.display='block';targetParentElement.style.opacity=1;targetPageElement.style.visibility='visible';targetPageElement.style.opacity=1;}}else{scrollToTop();if(transition=='fade'){if(currentParentId===targetParentId){if(isTargetInTimeline()){tweenWithinTimeline();}else{fadeInChild(targetPageElement);fadeOutChild(currentPageElement);}}else if(currentParentId){if(isTargetInTimeline()){endCurrentTimeline();startNewTimeline();}else{fadeIn(targetParentElement);fadeInChild(targetPageElement);fadeOut(currentParentElement);fadeOutChild(currentPageElement);}}else{if(isTargetInTimeline()){startNewTimeline();}else{fadeInChild(targetPageElement);}fadeIn(targetParentElement);fadeOut(currentPageElement);}}else{targetParentElement.style.zIndex=2;targetParentElement.style.display='block';targetPageElement.style.zIndex=2;targetPageElement.style.display='visible';currentPageElement.style.zIndex=1;currentPageElement.style.display='none';}}currentParentId=targetParentId;currentParentElement=targetParentElement;}function isTargetInTimeline(){return isTimelinesActive&&V.Timelines[targetParentId];}function endCurrentTimeline(){V.Timelines[currentTimelineId].kill();fadeOut(V.Timelines[currentTimelineId].pagesSelector);currentTimelineId=undefined;}function startNewTimeline(){currentTimelineId=targetParentId;tl=V.Timelines[currentTimelineId];var $pages=TweenLite.selector(tl.pagesSelector);if(tl.needsRebuild){tl.build();V.Timelines[currentTimelineId].needsRebuild=false;}setTimeout(tl.play.bind(tl,targetPageId),0);}function tweenWithinTimeline(){if(tl.labelNames){var currentLabelIndex=tl.labelNames.indexOf(tl.currentLabel());var idLabelIndex=tl.labelNames.indexOf(targetPageId);if(currentLabelIndex-1==idLabelIndex&&idLabelIndex>0){tl.reverse(currentLabelIndex);}else if(currentLabelIndex+1==idLabelIndex){tl.play(targetPageId);}else{tl.tweenTo(tl.labelNames[idLabelIndex+1]);}}else{tl.play(targetPageId);}}function fadeIn(selector){setTimeout(function fadeInDeferred(){TweenLite.set(selector,{zIndex:2});TweenLite.fromTo(selector,trDur,{opacity:0},{opacity:1,display:'block',overwrite:'all'});},0);}function fadeInChild(selector){setTimeout(function fadeInDeferred(){TweenLite.set(selector,{zIndex:2});TweenLite.fromTo(selector,0,{autoAlpha:0},{autoAlpha:1,overwrite:'all'});},0);}function fadeOut(selector){setTimeout(function fadeOutDeferred(){TweenLite.set(selector,{zIndex:1});TweenLite.set(selector,{delay:trDur,opacity:0,display:'none',overwrite:'all'});},0);}function fadeOutChild(selector){setTimeout(function fadeOutDeferred(){TweenLite.set(selector,{zIndex:1});TweenLite.set(selector,{delay:0,autoAlpha:0,overwrite:'all'});},0);}function scrollToTop(){TweenLite.to([document.documentElement,document.body],0.3,{scrollTop:0,autoCSS:false});}function updatePeripherals(){if(V.Menu&&V.Menu.getList()){V.Menu.render();}updateGate();if(!V.SCORM.isConnected()){updateAddressBar();}}function callOnEnter(){if(V.Pages[targetPageId].onEnter){setTimeout(V.Pages[targetPageId].onEnter,0);}}function updateSCORM(){V.SCORM.setLocation(targetPageId);V.SCORM.setViewed(targetPageId);V.SCORM.setViewed(targetParentId);}function updateGate(){if(V.Pages[targetPageId].hasGate){gateText.innerHTML=V.Pages[targetPageId].gateText||'Please complete this activity before proceeding to the next page.';if(!V.SCORM.getCompleted(targetPageId)){body.classList.add('-next-disabled');}else{body.classList.remove('-next-disabled');}}else{body.classList.remove('-next-disabled');}if(targetParentId&&V.Pages[targetParentId].gateText){gateText.innerHTML=V.Pages[targetParentId].gateText;}}function updateAddressBar(){var newURL=void 0;var currentURLmatches=(window.location.href+'').match(/([\?&])p=([^\?&]*)/);var restOfURL=(window.location.href+'').split(/[\?&]p=[^\?&]*/);if(restOfURL[0].indexOf('/app.html')===-1){return false;}if(currentURLmatches&&restOfURL){restOfURL[0]=restOfURL[0].split('/app.html')[1];newURL='/app.html'+restOfURL[0]+currentURLmatches[1]+'p='+targetPageId+restOfURL[1];}else{restOfURL[1]=restOfURL[0].split('/app.html')[1];newURL=('/app.html'+restOfURL[1]+'&p='+targetPageId).replace('app.html&','app.html?');}window.history.pushState({},'',newURL);}}function next(){if(_isLocked){console.info('Navigation is locked.');return false;}if(isGateClosed()){return false;}targetPageId=findNextPage(currentPageId);if(!targetPageId){return false;}if(V.Pages[currentPageId].onNext&&V.Pages[currentPageId].onNext()===false){return false;}var parent=V.Pages[currentPageId].parent;if(parent&&V.Pages[parent].children.indexOf(targetPageId)===-1&&parent.onNext&&parent.onNext()===false){return false;}go();}function findNextPage(id){if(V.Pages[id].parent){var parent=V.Pages[id].parent;var siblings=V.Pages[parent].children;var index=siblings.indexOf(id);if(index===-1){console.error('Child page #'+id+' was not registered to its parent, #'+V.Pages[id].parent+'.');}else if(index+1<siblings.length){return siblings[index+1];}else{id=parent;}}if(V.Pages[id].nextPage){return V.Pages[id].nextPage;}else{var _index=pageNavigationOrder.indexOf(id);if(_index===-1){console.error('The page #'+id+' was not found in `pageNavigationOrder`.');}else if(_index+1<pageNavigationOrder.length){return pageNavigationOrder[_index+1];}else{console.warn('`#'+id+'` is the last page.');return false;}}return false;}function prev(){if(_isLocked){console.info('Navigation is locked.');return false;}targetPageId=findPrevPage(currentPageId);if(!targetPageId){return false;}var children=V.Pages[targetPageId].children;if(children){targetPageId=children[children.length-1];}go();}function findPrevPage(id){if(V.Pages[id].parent){var parent=V.Pages[id].parent;var siblings=V.Pages[parent].children;var index=siblings.indexOf(id);if(index===-1){console.error('Child page #'+id+' was not registered to its parent, #'+V.Pages[id].parent+'.');}else if(index>0){return siblings[index-1];}else{id=parent;}}if(V.Pages[id].prevPage){return V.Pages[id].prevPage;}else{var _index2=pageNavigationOrder.indexOf(id);if(_index2===-1){console.error('The page #'+id+' was not found in `pageNavigationOrder`.');}else if(_index2>0){return pageNavigationOrder[_index2-1];}else{console.warn('`#'+id+'` is the first page.');return false;}}return false;}function showGate(){body.classList.add('-show-gate');document.addEventListener('keydown',gateKeydown);}function hideGate(){body.classList.remove('-show-gate');document.removeEventListener('keydown',gateKeydown);}function isGateClosed(){if(!V.Pages[currentPageId].hasGate&&!(currentParentId&&V.Pages[currentParentId].hasGate)){return false;}if(V.SCORM.getCompleted(currentPageId)){return false;}if(V.Menu&&V.Menu.isUnlocked()){return false;}if(V.Pages[currentPageId].onGate&&V.Pages[currentPageId].onGate()){return false;}else{console.info('`V.Pages.'+currentPageId+'.onGate()` returned false.');}console.info('Page has not been completed.');showGate();return true;}function setGateText(text){gateText.innerHTML=text;}function openGate(id){id=id||currentPageId;V.SCORM.setCompleted(id);body.classList.remove('-next-disabled');}function gateKeydown(event){if(event.keyCode==13||event.keyCode==32||event.keyCode==27){event.preventDefault();hideGate();event.stopPropagation();}}var blinkTL=new TimelineMax({paused:true,repeat:-1});var nextArrow=document.querySelectorAll('.arrows__arrow--next');var blinkSpeed=0.1;blinkTL.add(TweenLite.to(nextArrow,blinkSpeed,{opacity:1,ease:Sine.easeInOut}));blinkTL.add(TweenLite.to(nextArrow,blinkSpeed,{opacity:0.1,ease:Sine.easeInOut}),'+='+blinkSpeed*4);blinkTL.add(TweenLite.set({},{}),'+='+blinkSpeed*4);stopBlink();function blink(){blinkTL.play();}function stopBlink(){blinkTL.pause();TweenLite.set(nextArrow,{clearProps:'all'});}function closePeripherals(){if(V.Menu){V.Menu.close();}hideGate();stopBlink();}function playAudio(audioId){if(!audioEnabled){return false;}if(audioNowPlaying&&audioId===audioNowPlaying){resumeAudio();return true;}stopAudio();if(typeof document.hidden==='boolean'&&document.hidden){return false;}if(typeof audioId!=='string'||audioId.length===0){return false;}if(!isMuted){getAudio(audioId);audioNowPlaying=audioId;audioTimeout=setTimeout(function(){if(!audioNowPlaying){console.log('canceled audio');return false;}else{var file=audioFiles[audioNowPlaying];if(!isMuted){TweenLite.set(file,{volume:1,overwrite:'all'});file.currentTime=0;file.play();}}},600);}else{audioNowPlaying=audioId;}}function getAudio(audioId){if(!audioEnabled){return false;}var file;if(audioFiles[audioId]){file=audioFiles[audioId];}else{if(isMuted){return false;}var filePath='audio/'+audioId;if(filePath.substr(-4)!=='.mp3'){filePath+='.mp3';}file=new Audio(filePath);audioFiles[audioId]=file;}return file;}function pauseAudio(trDur){if(!audioEnabled){return false;}if(typeof trDur!=='number'){trDur=0.8;}var file=audioFiles[audioNowPlaying];if(file){TweenLite.to(file,trDur,{volume:0,onComplete:function onComplete(){file.pause();},ease:'audioEaseOut',overwrite:'all'});}}function stopAudio(trDur){if(!audioEnabled||!audioFiles){return false;}if(typeof trDur!=='number'){trDur=0.8;}var file=audioFiles[audioNowPlaying];if(file&&!file.paused&&file.currentTime){TweenLite.to(file,trDur,{volume:0,onComplete:function onComplete(){file.pause();if(file.currentTime){file.currentTime=0;}},ease:'audioEaseOut',overwrite:'all'});}audioNowPlaying=false;}function resumeAudio(){if(!audioEnabled){return false;}if(audioNowPlaying){var file=getAudio(audioNowPlaying);if(file.ended){return false;}if(!file.paused&&file.currentTime){console.warn('The file '+audioNowPlaying+' is already playing.');return false;}var currentTime=file.currentTime;if(currentTime>1.5){file.currentTime=currentTime-1.5;}else if(file.currentTime){file.currentTime=0;}if(!isMuted){file.play();TweenLite.to(file,0.5,{volume:1,ease:Expo.easeIn,overwrite:'all'});}}}function muteAudio(){if(!audioEnabled){return false;}isMuted=true;V.SCORM.set('mute',true);if(audioNowPlaying){pauseAudio();}}function unmuteAudio(){if(!audioEnabled){return false;}isMuted=false;V.SCORM.set('mute',false);if(audioNowPlaying){resumeAudio();}}function disableAudio(){document.body.classList.add('-audio-disabled');stopAudio();audioEnabled=false;}function enableAudio(){if(window.matchMedia('(min-width: 50em)').matches&&V.Project.config.hasAudio){document.body.classList.remove('-audio-disabled');audioEnabled=true;return true;}return false;}function initMuteButton(){var muteButton=document.getElementById('mute-button');if(muteButton&&audioEnabled){if(isMuted){muteButton.classList.add('-is-muted');}muteButton.addEventListener('click',function(){if(isMuted){muteButton.classList.remove('-is-muted');unmuteAudio();}else{muteButton.classList.add('-is-muted');muteAudio();}});}}function initNavigateOnKeydown(){var throttledNext=_.throttle(next,300);var throttledPrev=_.throttle(prev,300);document.addEventListener('keydown',navigateOnKeydown);function navigateOnKeydown(event){if(_.isUserTyping(event)){return false;}if(event.keyCode==39){throttledNext();}if(event.keyCode==37){throttledPrev();}if(!V.SCORM.isConnected()){if(event.keyCode==85){if(V.Menu){V.Menu.unlock();}}if(event.keyCode==76){window.open(V.SCORM.log());}}}}})(window.V);
//# sourceMappingURL=maps/V.Navigation.min.js.map
