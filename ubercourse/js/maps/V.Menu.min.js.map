{"version":3,"sources":["V.Menu.js"],"names":["initMenu","V","document","Menu","build","buildMenu","close","closeMenu","getList","getMenuItemList","isUnlocked","isMenuUnlocked","render","renderMenu","unlock","unlockMenu","body","menuList","querySelector","menuProgress","textContent","Project","config","title","menuItemList","totalPages","numberings","addEventListener","menuOnDOMReady","onclick","classList","toggle","remove","newMenuItemList","options","length","newNumberings","i","iMax","setNavigation","pageList","id","Pages","parent","push","Navigation","setOrder","console","warn","levelCount","unlocked","output","viewedPages","item","hidden","j","SCORM","getViewed","pageChildren","children","level","isCurrentPage","getLocation","indexOf","isAboveCurrentPage","className","numbering","replace","innerHTML","currentPage","scrollTop","offsetTop","offsetHeight","style","width","menuLinks","querySelectorAll","keydownMenuLink","menuLinkListeners","pageId","getAttribute","followMenuLink","bind","e","log","keyCode","window"],"mappings":"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","file":"../V.Menu.min.js","sourcesContent":["// ====================================\r\n//\r\n//   Menu\r\n//\r\n// ====================================\r\n\r\n;(function initMenu(V, document) {\r\n  V.Menu = {\r\n    build: buildMenu,\r\n    close: closeMenu,\r\n    getList: getMenuItemList,\r\n    isUnlocked: isMenuUnlocked,\r\n    render: renderMenu,\r\n    unlock: unlockMenu\r\n  };\r\n\r\n  // store some DOM elements we will need often\r\n  const body = document.body;\r\n  const menuList = document.querySelector('.main-menu__list');\r\n  const menuProgress = document.querySelector('.main-menu__progress-fill');\r\n\r\n  document.querySelector('.main-menu__heading').textContent = V.Project.config.title;\r\n\r\n  // closured variables for build and render\r\n  let menuItemList;\r\n  let totalPages;\r\n  let numberings;\r\n\r\n  /**\r\n   * Render the menu on DOM ready and add listeners\r\n   * for opening and closing the menu.\r\n   */\r\n  document.addEventListener('DOMContentLoaded', function menuOnDOMReady() {\r\n    document.querySelector('.main-menu__button').onclick = function () {\r\n      body.classList.toggle('-open-menu');\r\n    };\r\n\r\n    document.querySelector('.main-menu__close-button').onclick = closeMenu;\r\n    document.querySelector('.main-menu__close-overlay').onclick = closeMenu;\r\n\r\n    renderMenu();\r\n  });\r\n\r\n  function closeMenu() {\r\n    body.classList.remove('-open-menu');\r\n  }\r\n\r\n  var isUnlocked = false;\r\n\r\n  function isMenuUnlocked() {\r\n    return isUnlocked;\r\n  }\r\n\r\n  function unlockMenu() {\r\n    isUnlocked = true;\r\n    renderMenu();\r\n    return true;\r\n  }\r\n\r\n  function getMenuItemList() {\r\n    return menuItemList;\r\n  }\r\n\r\n  function buildMenu(newMenuItemList, options) {\r\n    options = options || {};\r\n    menuItemList = newMenuItemList;\r\n    totalPages = newMenuItemList.length;\r\n\r\n    // make sure `numberings` has length 3\r\n    numberings = [null, null, null];          \r\n    const newNumberings = options.numberings || [];\r\n\r\n    for (let i = 0, iMax = newNumberings.length; i < iMax; i++) {\r\n      numberings[i] = newNumberings[i];\r\n    }\r\n\r\n    renderMenu();\r\n\r\n    if (options.setNavigation) {\r\n      const pageList = [];\r\n      \r\n      // build list of IDs from menu\r\n      for (let i = 0, iMax = menuItemList.length; i < iMax; i++) {\r\n        const id = (typeof menuItemList[i] === 'string')\r\n          ? menuItemList[i]\r\n          : menuItemList[i].id;\r\n\r\n        if (id) {\r\n          if (V.Pages[id].parent) {\r\n            // if a child page, add parent to list, but only once\r\n            if (pageList.length === 0) {\r\n              pageList.push(V.Pages[id].parent);\r\n            } else if (pageList[pageList.length - 1] !== V.Pages[id].parent) {\r\n              pageList.push(V.Pages[id].parent);      \r\n            }\r\n          } else {\r\n            // add page to list\r\n            pageList.push(id);\r\n          }\r\n        }\r\n      }\r\n\r\n      V.Navigation.setOrder(pageList);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Function that renders the menu HTML using data from V.Menu\r\n   * and V.Pages and inserts it into the DOM.\r\n   */\r\n  function renderMenu() {\r\n    if (!menuItemList) {\r\n      console.warn('No menu available to render.');\r\n\r\n      return false;\r\n    }\r\n    \r\n    let levelCount = [0, 0, 0];\r\n    let unlocked = true;\r\n    let output = '';\r\n    let viewedPages = 0;\r\n    const totalPages = menuItemList.length;\r\n    \r\n    for (let i = 0; i < totalPages; i++) {\r\n      const item = (typeof menuItemList[i] === 'string') \r\n        ? {id: menuItemList[i]}\r\n        : menuItemList[i];\r\n\r\n      if (!item.hidden) {        \r\n        let id = item.id;\r\n        \r\n        // find next page that is not hidden\r\n        if (!id) {\r\n          let j = i;\r\n\r\n          while (!id && j < totalPages - 1) {\r\n            j++;\r\n\r\n            if (!menuItemList[j].hidden) {\r\n              id = (typeof menuItemList[j] === 'string')\r\n                ? menuItemList[j]\r\n                : menuItemList[j].id;\r\n            }\r\n          }\r\n        }\r\n\r\n        viewedPages += V.SCORM.getViewed(id);\r\n        const pageChildren = V.Pages[id].children || false;\r\n        const level = item.level || 0;\r\n\r\n        const title = item.title \r\n          || (id && V.Pages[id].title) \r\n          || console.warn(`Page #${id} is missing a title.`);\r\n\r\n        /**\r\n         * When we get to a page that has been viewed, if `unlocked` \r\n         * is still true and the menu isn't unlocked, set `unlocked`\r\n         * to false.\r\n         */\r\n        if (unlocked && !V.SCORM.getViewed(id) && !isMenuUnlocked()) {\r\n          unlocked = false;\r\n        } \r\n\r\n        const isCurrentPage = (\r\n          item.id && V.SCORM.getLocation() === item.id\r\n          || (\r\n            pageChildren\r\n            && pageChildren.indexOf(V.SCORM.getLocation()) !== -1\r\n          )\r\n        );\r\n\r\n        const isAboveCurrentPage = (!item.id && V.SCORM.getLocation() === id);\r\n\r\n        let className = 'main-menu__item';\r\n        className += !unlocked          ? ' main-menu__item--locked'         : '';\r\n        className += level > 0          ? ` main-menu__item--level-${level}` : '';\r\n        className += isCurrentPage      ? ` main-menu__item--current`        : '';\r\n        className += isAboveCurrentPage ? ` main-menu__item--above-current`  : '';\r\n\r\n        const onclick = (unlocked && !isCurrentPage && !isAboveCurrentPage)\r\n          ? `onclick=\"V.Navigation.go('${id}');\"`\r\n          : '';\r\n\r\n        // update `levelCount`\r\n        if (level == 2) {\r\n          levelCount[0] = 0;\r\n          levelCount[1] = 0;\r\n          levelCount[2]++;\r\n        } else if (level == 1) {\r\n          levelCount[0] = 0;\r\n          levelCount[1]++;\r\n        } else {\r\n          levelCount[0]++;\r\n        }\r\n\r\n        let numbering = numberings[2 - level] || '';\r\n\r\n        if (numbering) {\r\n          numbering = numbering.replace('{2}', levelCount[2] || 1)\r\n            .replace('{1}', levelCount[1] || 1)\r\n            .replace('{0}', levelCount[0] || 1);\r\n        }\r\n\r\n        // append to output\r\n        output += `<div class=\"${className}\" ${onclick} tabindex=\"0\"><span class=\"main-menu__numbering-${level}\">${numbering}</span> <span \"main-menu__text-level-${level}\">${title}</span></div>`;\r\n\r\n      }\r\n    }\r\n\r\n    menuList.innerHTML = output;\r\n\r\n\r\n    // scroll to current page centered in menu\r\n    var currentPage = document.querySelector('.main-menu__item--current');\r\n\r\n    if (currentPage) {\r\n      menuList.scrollTop = currentPage.offsetTop - currentPage.offsetHeight - menuList.offsetHeight/2;\r\n    }\r\n\r\n    // update progress bar\r\n    menuProgress.style.width = `${viewedPages / totalPages * 100}%`;\r\n\r\n    // .main-menu__page listeners\r\n    var menuLinks = document.querySelectorAll('.main-menu__page, .main-menu__part-title, .main-menu__module-title');\r\n    var keydownMenuLink;\r\n\r\n    for (let i = 0, length = menuLinks.length; i < length; i++) {\r\n      // create a closure for pageId\r\n      (function menuLinkListeners() {\r\n        var pageId = menuLinks[i].getAttribute('data-page-id');\r\n        if (!pageId) {\r\n          return false;\r\n        }\r\n\r\n        // click event\r\n        menuLinks[i].addEventListener('click', followMenuLink.bind(null, pageId));\r\n\r\n        // keydown event\r\n        menuLinks[i].addEventListener('keydown', function keydownMenuLink(e) {\r\n          console.log(e, pageId);\r\n          if (e.keyCode == 13) {\r\n            followMenuLink(pageId);\r\n          }\r\n        });\r\n      })();\r\n    }\r\n  }\r\n\r\n})(window.V, document);\r\n"]}