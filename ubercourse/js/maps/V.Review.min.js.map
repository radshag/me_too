{"version":3,"sources":["V.Review.js"],"names":["initReview","V","Review","isInternal","isLocal","isActive","window","location","href","indexOf","SCORM","get","defaultFirm","customFirm","prompt","toUpperCase","set","console","log","document","addEventListener","lastCommit","Project","config","frag","createElement","pageIds","pages","querySelectorAll","i","iMax","length","push","id","menuHTML","map","Pages","parent","title","trim","join","innerHTML","replace","querySelector","appendChild","firstElementChild","openPanel","localhostLink","getElementById","textContent","Lightboxes","open","reviewKeyDown","event","isUserTyping","keyCode","reset","resetCourse","pipwerks","setScore","setLocation","setLessonStatus","reload","type","target","tagName","toLowerCase"],"mappings":"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","file":"../V.Review.min.js","sourcesContent":[";(function initReview(V) {\r\n  V.Review = {\r\n    isInternal,\r\n    isLocal,\r\n    isActive\r\n  };  \r\n\r\n  function isInternal () {\r\n    return window.location.href.indexOf('://uk.onlinecompliance.org/SharedScormCourses2012/CustomScormCourses/Internal/') !== -1;\r\n  }\r\n\r\n  function isLocal() {\r\n    return window.location.href.indexOf('://localhost:') !== -1;\r\n  }\r\n\r\n  function isActive () {\r\n    return isInternal() || isLocal();\r\n  }\r\n\r\n  if (isActive()) {\r\n    if (isInternal() && !V.SCORM.get('custom firm code')) {\r\n      const defaultFirm = 'INTERNAL';\r\n\r\n      const customFirm = (window.prompt(\r\n        `Type a firm code, or press Enter to use \"${defaultFirm}\".`\r\n      ) || defaultFirm).toUpperCase();\r\n\r\n      V.SCORM.set('Var_firm_name', customFirm);\r\n      V.SCORM.set('custom firm code', customFirm);\r\n      console.log(`custom firm code: \"${customFirm}\"`);\r\n    }\r\n\r\n    document.addEventListener('DOMContentLoaded', function () {   \r\n      const lastCommit = V.Project.config.lastCommit || 'Not available :/';\r\n      const frag = document.createElement('div');\r\n\r\n      const pageIds = [];\r\n      const pages = document.querySelectorAll('.page, .child-page');\r\n      \r\n      for (let i = 0, iMax = pages.length; i < iMax; i++) {\r\n        pageIds.push(pages[i].id);\r\n      }\r\n\r\n      menuHTML = pageIds.map(id => `\r\n        <span \r\n          onclick=\"V.Navigation.go('${id}');V.Lightboxes.close();\"\r\n          style=\"line-height:24px;border:2px solid #fff; font-size: 0.8em; border-width: 3px 0px 2px; background:rgba(0,0,0,0.06); cursor:pointer; padding:2px 8px; margin: 3px; display: inline-block; vertical-align: bottom; border-bottom-color:rgba(0,0,0,0.4); ${\r\n            V.Pages[id].parent ? 'opacity: 0.5;' : '' } \" \r\n        >\r\n          ${ V.Pages[id].title || ''} <span style=\"opacity:0.5;font-family:monospace;\">(${id})</span>\r\n        </span>\r\n      `.trim()).join(' ');\r\n\r\n      frag.innerHTML = `\r\n        <div class=\"lightbox -has-close-button\" id=\"lightbox-review-panel\">\r\n          <div class=\"lightbox__overlay\"></div>\r\n          <div class=\"lightbox__box\" style=\"padding: 0 1em\">\r\n            <div class=\"lightbox__close-button\" style=\"display:none;\">Close</div>\r\n            <div class=\"lightbox__content\" style=\"max-height: 70vh;margin: 1em 0;\">\r\n\r\n              <h2 style=\"margin-top:1em;text-align:center;\">Review Panel</h2>\r\n\r\n              <h3>Latest commit</h3>\r\n              <pre style=\"max-height:15em;font-size:0.8em;padding:0.5em;overflow-y:auto;background:rgba(0,0,0,0.05)\">${lastCommit.replace(/</g,'&lt;').trim()}</pre>\r\n\r\n\r\n              <h3>Localhost link</h3>\r\n              <p>This link will open the course on localhost with your current location and data:\r\n              <pre style=\"max-height:15em;font-size:0.8em;padding:0.5em;overflow-y:auto;background:rgba(0,0,0,0.05)\"><a href=\"${V.SCORM.log()}\" target=\"_blank\" id=\"review-panel-localhost-link\">${V.SCORM.log()}</a></pre>\r\n\r\n              <h3>Go somewhere</h3>\r\n              <form onsubmit=\"V.Navigation.go(this.querySelector('input').value);V.Lightboxes.close();return false;\">\r\n                <p><input style=\"width:100%;padding:0.5em;\" placeholder=\"Type a page ID and press Enter\"/></p>\r\n              </form>\r\n              <p>\r\n                ${menuHTML}\r\n              </p>\r\n\r\n              ${ isInternal() ? `              \r\n              <h3>Reset the course</h3>\r\n              <p>Click this button to reset everything you've done since enrolling in the course: your custom firm code, suspend data, location, score, and completion status. This button also refreshes the window.</p>\r\n              <p style=\"text-align:center;\">\r\n                <button style=\"padding:1em 1.5em;\" onclick=\"V.Review.reset()\">Reset</button>\r\n              </p>\r\n              ` : ''}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      `;\r\n\r\n      document.querySelector('.lightboxes').appendChild(frag.firstElementChild);\r\n\r\n      V.Review.openPanel = function openPanel() {\r\n        const localhostLink = document.getElementById('review-panel-localhost-link');\r\n        localhostLink.href = V.SCORM.log();\r\n        localhostLink.textContent = V.SCORM.log();\r\n        V.Lightboxes.open('lightbox-review-panel');\r\n      };\r\n\r\n      document.addEventListener('keydown', function reviewKeyDown(event) {\r\n        if (isUserTyping(event)) {\r\n          return false;\r\n        }\r\n\r\n        // `P` opens panel\r\n        if (event.keyCode == 80) {\r\n          V.Review.openPanel();\r\n        }\r\n      });\r\n\r\n      V.Review.reset = function resetCourse() {\r\n        if (isInternal()) {\r\n          pipwerks.SCORM.set('cmi.suspend_data', ''); \r\n          V.SCORM.setScore(0); \r\n          V.SCORM.setLocation(''); \r\n          V.SCORM.setLessonStatus('incomplete'); \r\n          window.parent.location.reload();\r\n        } else {\r\n          console.log('Not internal.');\r\n\r\n          return false;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  function isUserTyping(event) {\r\n    return (\r\n      event.type.indexOf('key') !== 1 \r\n      && ['input','textarea'].indexOf(event.target.tagName.toLowerCase()) !== -1\r\n    );\r\n  }\r\n})(window.V);\r\n"]}