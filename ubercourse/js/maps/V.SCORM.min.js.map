{"version":3,"sources":["V.SCORM.js"],"names":["window","V","initSCORM","SCORM","get","set","clearSuspendData","setViewed","getViewed","setCompleted","getCompleted","setLocation","getLocation","setScore","getScore","addToScore","passed","failed","getLessonStatus","setLessonStatus","getFirm","isFirm","log","isConnected","quit","pipwerks","save","pw","version","initSuccess","initAttempts","init","e","connected","connection","isActive","firstName","split","lastName","userName","isDemo","suspendString","suspendObject","suspendPairs","initSuspendObject","score","parseInt","getURLParameter","n","name","levelNames","value","i","length","hasOwnProperty","dontSave","level","saveSuspendData","id","viewedPages","indexOf","push","completedActivities","lessonLocation","getPrevLocation","lessonStatus","status","toUpperCase","firm","addEventListener","setExit","exit","location","origin","encodeURIComponent","document","saveClicksOnReady","setTimeout","saveClicks","getDefaultSuspendData","console","match","JSONString","JSON","parse","decodeURIComponent","pairs","pair","slice","stringify","replace","newString","Object","keys","forEach","key","offlineSuspendData","RegExp","exec","search","pages","getElementsByClassName","pageID","elements","iMax","j","jMax","isReenactingClicks","savedClicks","click","saveClick","bind"],"mappings":"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","file":"../V.SCORM.min.js","sourcesContent":["// ====================================\r\n//\r\n//   SCORM.js\r\n//\r\n// ====================================\r\n\r\n/**\r\n * Creates global namespace V (for \"VinciWorks\") to include\r\n * V.SCORM and V.Navigation; and optionally V.Pages, V.Menu, \r\n * and V.Timelines\r\n */\r\nwindow.V = {};\r\n\r\n/**\r\n * V.SCORM object with useful properties and methods\r\n * wrapping the pipwerks SCORM API wrapper:\r\n * https://github.com/pipwerks/scorm-api-wrapper/\r\n */\r\n;(function initSCORM(V) {\r\n  V.SCORM = {\r\n    // any variable in suspend data\r\n    get: get,\r\n    set: set,\r\n\r\n    // clear all data created in session\r\n    clearSuspendData: clearSuspendData,\r\n\r\n    // page views\r\n    setViewed: setViewed,\r\n    getViewed: getViewed,\r\n\r\n    // completed activities\r\n    setCompleted: setCompleted,\r\n    getCompleted: getCompleted,\r\n\r\n    // cmi.core.lesson_location\r\n    setLocation: setLocation,\r\n    getLocation: getLocation,\r\n\r\n    // cmi.core.score.raw\r\n    setScore: setScore,\r\n    getScore: getScore,\r\n    addToScore: addToScore,\r\n\r\n    // cmi.core.lesson_status\r\n    passed: passed,\r\n    failed: failed,\r\n    getLessonStatus: getLessonStatus,\r\n    setLessonStatus: setLessonStatus,\r\n\r\n    // get Var_firm_name\r\n    getFirm: getFirm,\r\n    isFirm: isFirm,\r\n\r\n    // console.log url representing saved session\r\n    log: log,\r\n\r\n    // is there an active SCORM connection?\r\n    isConnected: isConnected,\r\n\r\n    // SCORM session\r\n    quit: pipwerks.SCORM.quit,\r\n    save: pipwerks.SCORM.save\r\n  };\r\n\r\n  // shortcut for pipwerks API\r\n  var pw = pipwerks.SCORM;\r\n\r\n  // initialize connection, take 3 tries\r\n  pw.version = \"1.2\";\r\n  var initSuccess;\r\n  var initAttempts = 3;\r\n\r\n  while (initAttempts--) {\r\n    try {\r\n      initSuccess = pw.init();\r\n    } catch (e) {}\r\n\r\n    if (initSuccess) {\r\n      initAttempts = 0;\r\n    }\r\n  }\r\n\r\n  var connected = pw.connection.isActive;\r\n\r\n  function isConnected() {\r\n    return connected;\r\n  }\r\n\r\n  V.SCORM.connected = connected;\r\n\r\n  // name variables\r\n  if (connected) {\r\n    V.SCORM.firstName = pw.get('cmi.core.student_name').split(\",\")[1];\r\n    V.SCORM.lastName  = pw.get('cmi.core.student_name').split(\",\")[0];\r\n    V.SCORM.userName  = pw.get('cmi.core.student_id');\r\n  } else {\r\n    V.SCORM.firstName = 'Demo';\r\n    V.SCORM.lastName  = 'User';\r\n    V.SCORM.userName  = 'demo_user';\r\n  }\r\n\r\n  var isDemo = (V.SCORM.userName === 'MASTERDEMO' || V.SCORM.userName === 'MASTERANONYMOUS');\r\n\r\n  if (isDemo) {\r\n    pw.set  = function () {return false;};\r\n    pw.save = function () {return false;};\r\n  }\r\n\r\n  var suspendString = '';\r\n\r\n  // object for accessing suspend data variables during runtime\r\n  var suspendObject = {};\r\n\r\n  // store key-value pairs generated by LMS separately\r\n  var suspendPairs = {};\r\n\r\n  // initialize `suspendObject` and `suspendPairs`\r\n  initSuspendObject();\r\n\r\n  var score = parseInt(connected ? pw.get('cmi.core.score.raw') || 0 : getURLParameter('score') || 0);\r\n\r\n  function setScore(n) {\r\n    score = n;\r\n    pw.set('cmi.core.score.raw', score);\r\n    pw.save();\r\n  }\r\n\r\n  function getScore() {\r\n    return score;\r\n  }\r\n\r\n  function addToScore(n) {\r\n    score += n;\r\n    pw.set('cmi.core.score.raw', score);\r\n    pw.save();\r\n  }\r\n\r\n  // if the score variable is falsy, initialize to 0\r\n  if (!score && score !== 0) {\r\n    setScore(0);\r\n  }\r\n\r\n  /**\r\n   * Returns data from the variables object. The parameter `name` \r\n   * is the name of the requested property as a string, and it may \r\n   * be multiple levels deep, e.g. `name = 'level1.level2.level3'`.\r\n   * \r\n   * @param  {string} name - The name of the property to return.\r\n   * @return {*} value - The property's value.\r\n   */\r\n  function get(name) {\r\n    if (typeof name === 'undefined') {\r\n      return suspendObject;\r\n    }\r\n    \r\n    if (suspendPairs[name]) {\r\n      return suspendPairs[name];\r\n    }\r\n\r\n    var levelNames = name.split('.');\r\n    var value = suspendObject;\r\n\r\n    // loop down to deepest level\r\n    for (var i = 0, length = levelNames.length; i < length; i++) {\r\n      if (value.hasOwnProperty(levelNames[i])) {\r\n        value = value[levelNames[i]];\r\n      } else {\r\n        // if at any time a property is not defined, return undefined\r\n        return void 0;\r\n      }\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  /**\r\n   * Sets a value in the variables object and saves to suspend \r\n   * data. The value may be nested in a property any number of \r\n   * levels deep, by passing the first parameter for example as \r\n   * `name = 'level1.level2.level3'`. If intermediate levels do\r\n   * not exist, then they are created.\r\n   * \r\n   * @param {string} name - The name of the property to set.\r\n   * @param {*} value - The value to set to the property.\r\n   * @param {boolean} dontSave - If true, skip `saveSuspendData()`.\r\n   */\r\n  function set(name, value, dontSave) {\r\n\r\n    if (suspendPairs[name]) {\r\n      suspendPairs[name] = value;\r\n    } else {\r\n  \r\n      var levelNames = name.split('.');\r\n      var level = suspendObject;\r\n  \r\n      // loop down to deepest level and set property to value\r\n      for (var i = 0, length = levelNames.length; i < length; i++) {\r\n        if (i + 1 < length) {\r\n          // dig deeper, create property if undefined\r\n          level[levelNames[i]] = level[levelNames[i]] || {};\r\n          level = level[levelNames[i]];\r\n        } else {\r\n          // set property to value\r\n          level[levelNames[i]] = value;\r\n        }\r\n      }      \r\n    }\r\n  \r\n    if (!dontSave) {\r\n      saveSuspendData();\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  // add an id to `viewedPages`\r\n  function setViewed(id) {      \r\n    // get the array\r\n    var viewedPages = get('viewedPages') || [];\r\n\r\n    // if the id is not already in the array, push it   \r\n    if (viewedPages.indexOf(id) === -1) {\r\n      viewedPages.push(id);\r\n\r\n      // set the array\r\n      set('viewedPages', viewedPages);\r\n\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  // return whether id exists in `viewedPages`\r\n  function getViewed(id) {\r\n    var viewedPages = get('viewedPages') || [];\r\n    return viewedPages.indexOf(id) !== -1;\r\n  }\r\n\r\n  // add an id to `completedActivities`\r\n  function setCompleted(id) {\r\n    var completedActivities = get('completedActivities') || [];\r\n    completedActivities.push(id);\r\n    set('completedActivities', completedActivities);\r\n  }\r\n\r\n  // return whether id exists in `completedActivities`\r\n  function getCompleted(id) {\r\n    var completedActivities = get('completedActivities') || [];\r\n    return completedActivities.indexOf(id) !== -1;\r\n  }\r\n\r\n  // get location from LMS or from URL parameter\r\n  var lessonLocation = (connected)\r\n    ? pw.get('cmi.core.lesson_location')\r\n    : getURLParameter('p');\r\n\r\n  if (isDemo) {\r\n    lessonLocation = false;\r\n  }\r\n\r\n  function setLocation(name) {\r\n    lessonLocation = name;\r\n    pw.set('cmi.core.lesson_location', lessonLocation);\r\n    pw.save();\r\n  }\r\n\r\n  function getLocation() {\r\n    return lessonLocation;\r\n  }\r\n\r\n  function getPrevLocation() {\r\n    var viewedPages = get('historyViewedPages');\r\n    return viewedPages[viewedPages.length - 2];\r\n  }\r\n\r\n  // get cmi.core.lesson_status\r\n  var lessonStatus = (connected)\r\n    ? pw.get('cmi.core.lesson_status')\r\n    : 'incomplete';\r\n\r\n  function setLessonStatus(status) {\r\n    lessonStatus = status;\r\n    pw.set('cmi.core.lesson_status', lessonStatus);\r\n    pw.save();\r\n  }\r\n\r\n  function getLessonStatus() {\r\n    return lessonStatus;\r\n  }\r\n\r\n  // pass the course\r\n  function passed() {\r\n    setLessonStatus('passed');\r\n  }\r\n\r\n  // fail the course\r\n  function failed() {\r\n    setLessonStatus('failed');\r\n  }\r\n\r\n  function getFirm() {\r\n   return get('Var_firm_name').toUpperCase();\r\n  }\r\n\r\n  function isFirm(firm) {\r\n    return firm.toUpperCase() === get('Var_firm_name').toUpperCase();\r\n  }\r\n\r\n  // set cmi.core.exit before unload\r\n  window.addEventListener('beforeunload', setExit);\r\n  window.addEventListener('unload', setExit);\r\n\r\n  function setExit() {\r\n    var exit = (lessonStatus === 'incomplete')\r\n      ? 'suspend'\r\n      : 'logout';\r\n\r\n    pw.set('cmi.core.exit', exit);\r\n    pw.save();\r\n  }\r\n\r\n  // return a query string representing an offline session\r\n  function log() {\r\n    return window.location.origin\r\n      + '/app.html?p='\r\n      + lessonLocation\r\n      + '&sd='\r\n      + encodeURIComponent(suspendString)\r\n      + '&score='\r\n      + score;\r\n  }\r\n\r\n  document.addEventListener(\"DOMContentLoaded\", \r\n    function saveClicksOnReady() {\r\n      /**\r\n       * setTimeout so that click event listeners from other \r\n       * scripts are added before `saveClicks()` is called\r\n       */\r\n      setTimeout(saveClicks, 0);\r\n    }\r\n  );\r\n\r\n  /**\r\n   * \r\n   */\r\n  function initSuspendObject() {\r\n    // get the string from LMS or URL parameter\r\n    if (connected) {\r\n      suspendString = pw.get('cmi.suspend_data');\r\n    } else if (getURLParameter('sd')) {\r\n      suspendString = getURLParameter('sd');\r\n    }\r\n\r\n    // if Varpassmark is missing, load from scormextern.js\r\n    if (suspendString.indexOf('Varpassmark') === -1) {\r\n      if (typeof getDefaultSuspendData === 'function') {\r\n        suspendString += getDefaultSuspendData();\r\n      } else {\r\n        console.log('Missing scormextern.js.');\r\n      }\r\n    }\r\n\r\n    console.log('Suspend Data: ' + suspendString);\r\n\r\n    var match = suspendString.match(/json=([^;]+);/);\r\n    var JSONString = match ? match[1] : '{}';\r\n\r\n    // parse the JSON and store in suspendObject\r\n    suspendObject = JSON.parse(decodeURIComponent(JSONString));\r\n\r\n    // parse the rest of the string\r\n    var pairs = suspendString.match(/([^=;]+)=([^=;]+);/g) || [];\r\n    var pair;\r\n    var i = pairs.length;\r\n\r\n    // add key=value; pairs to suspendPairs\r\n    while (i--) {\r\n      // remove final ';' and split on '='\r\n      pair = pairs[i].slice(0,-1).split('=');\r\n      if (pair[0] !== 'json') {\r\n        suspendPairs[pair[0]] = pair[1];\r\n      }\r\n    }\r\n\r\n    return suspendObject;\r\n  }\r\n\r\n  function clearSuspendData() {\r\n    suspendObject = {};\r\n    saveSuspendData();\r\n    // suspendString.replace(/json={[^;]+;/, '');\r\n  }\r\n\r\n\r\n  /**\r\n   * Stringifies the variables object and saves it to\r\n   * the LMS or offlineSuspendData.\r\n   * \r\n   * @return {string} newString - the updated suspend data string.\r\n   */\r\n  function saveSuspendData() {\r\n    // // timer for testing purposes\r\n    // var start = performance.now();\r\n    \r\n    var JSONString = JSON.stringify(suspendObject);\r\n    JSONString = JSONString.replace(/;/g,'%3B');\r\n    JSONString = JSONString.replace(/=/g,'%3D');\r\n\r\n    // convert object to string\r\n    var newString = 'json=' + JSONString + ';';\r\n\r\n    Object.keys(suspendPairs).forEach(function(key) {\r\n      newString += key + '=' + suspendPairs[key] + ';'\r\n    });\r\n\r\n    //Update the LMS with the new suspend data string\r\n    if (connected) {\r\n      // use setTimeout to defer expensive function calls\r\n      setTimeout(function () {\r\n        pw.set('cmi.suspend_data', newString);\r\n        pw.save();\r\n      }, 20);\r\n    }\r\n\r\n    suspendString = newString;\r\n    V.SCORM.offlineSuspendData = newString;\r\n  \r\n    // // log timer result\r\n    // console.log(\r\n    //   'saveSuspendData() took ', \r\n    //   Math.round(performance.now()*1e3 - start*1e3)/1e3, \r\n    //   'ms'\r\n    // );\r\n\r\n    console.log('saveSuspendData()');\r\n\r\n    return newString;\r\n  }    \r\n\r\n  /**\r\n   * Returns the value of a query parameter in the URL.\r\n   * Based on https://stackoverflow.com/a/11582513/\r\n   * \r\n   * @param  {string} name - the name of the query parameter\r\n   * @return {string} - the decoded value of the parameter\r\n   */\r\n  function getURLParameter(name) {\r\n    return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search) || [null, ''])[1].replace(/\\+/g, '%20')) || null;\r\n  }\r\n\r\n  /**\r\n   * Adds a click event listener `saveClick()` to every \r\n   * element that has the class 'save-click', and \r\n   * reenacts clicks that were saved in suspend data.\r\n   */\r\n  function saveClicks() {\r\n    var pages = document.getElementsByClassName('page');\r\n    var pageID;\r\n    var elements;\r\n    var i, iMax, j, jMax;\r\n\r\n    V.SCORM.isReenactingClicks = true;\r\n\r\n    // loop through pages\r\n    for (i = 0, iMax = pages.length; i < iMax; i++) {\r\n      pageID = pages[i].id;\r\n      elements = pages[i].getElementsByClassName('save-click');\r\n\r\n      if (elements.length) {\r\n        if (!suspendObject.savedClicks) {\r\n          suspendObject.savedClicks = {};\r\n        }\r\n\r\n        // loop through elements\r\n        for (j = 0, jMax = elements.length; j < jMax; j++) {\r\n          // reenact saved clicks\r\n          if (\r\n            suspendObject.savedClicks[pageID] \r\n            && suspendObject.savedClicks[pageID][j]\r\n          ) {\r\n            elements[j].click();\r\n          }\r\n\r\n          // add event listener for future clicks\r\n          elements[j].addEventListener(\r\n            'click', \r\n            saveClick.bind(null, pageID, j)\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    V.SCORM.isReenactingClicks = false;\r\n\r\n    /**\r\n     * @param  {number} pageID - The page ID.\r\n     * @param  {number} j - The element's index within the page.\r\n     * @this {element} - The element itself.\r\n     */\r\n    function saveClick(pageID, j) {\r\n      if (!suspendObject.savedClicks[pageID]) {\r\n        suspendObject.savedClicks[pageID] = [];\r\n      }\r\n\r\n      suspendObject.savedClicks[pageID][j] = 1;\r\n      saveSuspendData();\r\n    }\r\n  }\r\n})(window.V);\r\n"]}